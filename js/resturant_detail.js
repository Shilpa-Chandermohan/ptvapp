// Copyright (C) 2014 Open Rice & Panasonic Corporation. All Rights Reserved.
//
//****************************/
// File Name: restaurant_detail.js
// Purpose: This document creates details page with async true API
// File Created Date: 17-Oct-2013
// Release Date: 02-Jan-2014
// Release Version: 1.4
//****************************/
encodeVal = "QUl6YVN5QVAycnM0U0dhWkk2S21fTDVuU09UUFRQd0VXaUllQ2hJ";

try{var detailHotKey={"index":0};morePopUp={};detail={"curMapObj":1,"location":"","latitude":"","longitude":"","address":"","tel_num":"","restaurantName":"","currentPage":1,"zoomVal":"","returnObj":2,"photoIndex":0,"category":"","map":{}};detail.errorImgSrc="images/detail/default_image.png";detail.setDownArrow=function(){var left=document.getElementById('downArrow');var right=document.getElementById('upArrow');left.className="leftArrowClass";right.className="rightArrowClass";};detail.createDetail=function(from){try{global.screen=3;global.clearContents();global.mainMenu.leave_focus();if(global.gadget==2){if($("#regionPopUp").length>0){clearTimeout(search.maxLimitTimerObj);region.popUpHide();}
if(listing.selectedItem==""||search.Selections.region.country==""||search.Selections.region.city_Name[0]==""||search.Selections.region.city_Id[0]==""){global.splash.Off();global.loading.Off();global.showError("detail","clearBottom");global.mainMenu.makeSelected(0);global.rigthNav=null;if(search.Selections.region.country==""||search.Selections.region.city_Name[0]==""||search.Selections.region.city_Id[0]==""){global.mainMenu.removeSelection(1);}
global.mainMenu.enter_focus();return;}
if(search.Selections.region.country!=""&&search.Selections.region.city_Name[0]!=""&&search.Selections.region.city_Id[0]!=""){detailHotKey.create({"type":"Gadget"});}}else{if(global.gadget==1){detailHotKey.create({"type":"Search"});}else{detailHotKey.create({"type":"Refine Search"});}}
if(from&&from=="default"){detail.gridContainer.reset("createDetail");}else{global.mainMenu.leave_focus();}
detail.main=new detail.createHTMl();detail.getDetail();}catch(e){}};detailHotKey.create=function(param){var menu="";detailHotKey.index=0;menu="<div id='arrows'><div id='downArrow'></div><div id='upArrow'></div></div><div id='hotKeyCont'><div id='hotKeyOuter_4'><div class='hotKeys' id='HotKey_4'><div id='bluehotKeyImg'  class='hotKeyImg' ></div><div  id='label_4' class='hotKeyLabel'>";menu+=((param.type?param.type:"Search")+"</div></div></div>");menu+="<div id='hotKeyOuter_3'><div class='hotKeys' id='HotKey_3'><div id='backhotKeyImg' ></div><div  id='label_3' class='hotKeyLabel'>Back</div></div></div>";if(param.type=="Gadget"){menu="<div id='arrows'><div id='downArrow'></div><div id='upArrow'></div></div>";}
if(param.type=="Gadget"&&global.screen==4){menu="<div id='arrows'><div id='downArrow'></div><div id='upArrow'></div></div><div id='hotKeyCont'><div id='hotKeyOuter_4'><div class='hotKeys' id='HotKey_4'><div id='backhotKeyImg' ></div><div  id='label_4' class='hotKeyLabel'>Back</div></div></div>";}
if(!$("#bottomSection").hasClass("bottomSectionBg")){$("#bottomSection").addClass("bottomSectionBg");}
$("#bottomSection").html(menu);global.arrow=new global.ArrowClass();global.arrow.createArrow("left");global.arrow.showArrow("none");if(param.type=="Refine Search"){$("#hotKeyOuter_4").css("width","245px");$("#hotKeyOuter_4").css("background-size","100% 100%");$("#hotKeyOuter_4").css("margin","11px 0 0 1040px");$("#HotKey_4").css("width","245px");$("#label_4").css("width","179px");}
if(param.type=="Search"){$("#hotKeyOuter_4").css("width","160px");$("#hotKeyOuter_4").css("background-size","100% 100%");$("#hotKeyOuter_4").css("margin","12px 0 0 1110px");$("#HotKey_4").css("width","160px");$("#label_4").css("width","92px");}
if(param.type!="Gadget"){$("#hotKeyOuter_3").css("opacity","1");$("#hotKeyOuter_3").css("width","160px");$("#hotKeyOuter_3").css("background-size","100% 100%");$("#hotKeyOuter_3").css("margin","11px 0 0 1308px");$("#HotKey_3").css("width","160px");$("#label_3").css("width","92px");}
if(param.type=="Gadget"&&global.screen==4){$("#hotKeyOuter_4").css("opacity","1");$("#hotKeyOuter_4").css("width","160px");$("#hotKeyOuter_4").css("background-size","100% 100%");$("#hotKeyOuter_4").css("margin","11px 0 0 1308px");$("#HotKey_4").css("width","160px");$("#label_4").css("width","92px");}}
detailHotKey.enter_focus=function(){global.focusedDom=this;if(detailHotKey.index==0){if(global.screen==3||global.screen==4){$("#HotKey_4").addClass('hotKeyCurser');}else{$("#HotKey_1").addClass('hotKeyCurser');}}else{$("#HotKey_3").addClass('hotKeyCurser');}}
detailHotKey.leave_focus=function(){if(detailHotKey.index==0){if(global.screen==3||global.screen==4){$("#HotKey_4").removeClass('hotKeyCurser');}else{$("#HotKey_1").removeClass('hotKeyCurser');}}else{$("#HotKey_3").removeClass('hotKeyCurser');}}
detailHotKey.KeyboardEvent=function(e,eventType){var target=_target(e),keyCode=target.keyCode,key=global.keyCodeDic[keyCode];switch(eventType){case"keydown":switch(key){case"arrowleft":if(detailHotKey.index==0){if($("#gridSection").length>0){detail.main.photoGrid.currentItem=0;global.rigthNav=detail.main.photoGrid;}else{if($("#detailBtn_1").css("opacity")=="1"){detail.main.currIndex=0;}
global.rigthNav=detail.main;}
detailHotKey.leave_focus();global.mainMenu.enter_focus();}else{detailHotKey.leave_focus();detailHotKey.index=0;detailHotKey.enter_focus();}
return true;break;case"arrowright":if(detailHotKey.index==0&&global.gadget!=2){detailHotKey.leave_focus();detailHotKey.index=1;detailHotKey.enter_focus();}
return true;break;case"arrowup":if(global.screen==3){if($("#gridSection").length>0){detailHotKey.leave_focus();detail.main.photoGrid.enter_focus();}else{detailHotKey.leave_focus();detail.main.enter_focus();}}else{if($("#foodMenuCont").length>0){detailHotKey.leave_focus();detail.gridContainer.enter_focus(detail.photoIndex);}}
break;case"ok":if(detailHotKey.index==0){if(global.screen==3||global.screen==4){if(global.gadget==-1){global.clearContents();if(search.SearchAPIData.dataAvailability){search.showSearchScreen({"screen":global.firstSelTab(),"state":"init"})}else{search.createSearch();}}else if(global.gadget==1){global.clearContents();search.createSearch("resetUserReg");}else if(global.gadget==2){detailHotKey.leave_focus();global.returnFunc();}}else{detailHotKey.leave_focus();global.mainMenu.enter_focus();}}else{global.returnFunc();}
return true;break;}
return false;}
return false;};detail.setScreenCursor=function(){switch(detail.returnObj){case 0:if($("#detailBtn_1").css("opacity")>=1){detail.main.enter_focus();}else{global.mainMenu.enter_focus();}
break;case 1:detail.main.currIndex=1;detail.main.enter_focus();break;case 2:try{detail.main.photoGrid.currentItem=detail.photoIndex;detail.main.photoGrid.enter_focus();}catch(e){}
break;}}
morePopUp.createMorePopUp=function(){global.focusedDom=this;var fullMask="<div id = 'fullMask' class = 'fullMaskCls'></div>";var popUp="<div id='morePopUp' class= 'maxLimitPopUp'></div>";var closeButton="<div id='moreClose'></div>";if($("#morePopUp").length>0){$("#morePopUp").remove();}
$('#wrapper').append(fullMask);$('#wrapper').append(popUp);$("#morePopUp").append(closeButton);try{var text="";var det='<div id="moreTitle">'+$("#detailheadingval").html()+'</div><hr class="sep-line"/><div id="moreAddress" class="moreCont"><div class="moreLabel" id="morelocation">Address: </div>'+detail.address+'</div><div id="moretypebg" class="moreCont"><div class="moreLabel" id="moreCategory">'+$("#category").html()+'</div>'+detail.category+'</div><div id="moreDetailprice" class="moreCont"><div id="moreDetailphonetxt" class="moreLabel">Phone: </div>'+detail.tel_num+'</div><div id="moreCostDetail" class="moreCont"><div id="moreDetailpricetxt" class="moreLabel" >Spending: </div>';text=$("#detailpriceval").html();det+=text+'</div><div id="moreDetaildish" class="moreCont"><div id="moreDetaildishtxt" class="moreLabel" >Signature Dish(es): </div>'+detail.signatureDish+'</div>';$("#morePopUp").append(det);text=parseInt($("#morePopUp").height())+70;$("#morePopUp").height(text);$("#morePopUp").css("margin-top","0px");text=(1080-parseInt($("#morePopUp").height()))/2;$("#morePopUp").css("top",text);text=(1920-parseInt($("#morePopUp").width()))/2;$("#morePopUp").css("margin-left",text);}catch(e){}}
morePopUp.removeMorePopUp=function(){$("#morePopUp").remove();$("#fullMask").remove();detail.main.enter_focus();}
morePopUp.KeyboardEvent=function(e,eventType){var target=_target(e),keyCode=target.keyCode,key=global.keyCodeDic[keyCode];switch(eventType){case"keydown":switch(key){case"ok":morePopUp.removeMorePopUp();return true;break;}
return false;}
return false;};detail.createHTMl=function(){var wrapper=document.getElementById("innerSection"),parent=document.createElement('div'),topsection=document.createElement('div'),bottomsection=document.createElement('div'),bg=document.createElement('div'),heading=document.createElement('div'),headingval=document.createElement('div'),imgbg=document.createElement("div"),loading=document.createElement("p"),img=document.createElement("img"),address=document.createElement('div'),typebg=document.createElement('div'),typesArr=[],cuisine,restaurant,dish,theme,priceBg=document.createElement('div'),costBg=document.createElement('div'),phonetxt=document.createElement('div'),phoneval=document.createElement('div'),pricetxt=document.createElement('div'),priceval=document.createElement('div'),dishtxt=document.createElement('div'),dishval=document.createElement('div'),sigdish=document.createElement('div'),mapBtn,moreBtn,smileybg=document.createElement('div'),smileysmile=document.createElement('img'),smileysmiletxt=document.createElement('div'),smileyok=document.createElement('img'),smileyoktxt=document.createElement('div'),smileycry=document.createElement('img'),smileycrytxt=document.createElement('div');parent.className="detailParent";parent.id="detailParent";topsection.className="detailTopsection";topsection.id="detailTopsection";bottomsection.className="detailBottomsection";bottomsection.id="detailBottomsection";parent.appendChild(topsection);parent.appendChild(bottomsection);grid_pagination=document.createElement('div');grid_pagination.id="grid_pagination";grid_pagination.className="grid_pagination";parent.appendChild(grid_pagination);wrapper.appendChild(parent);this.components=[];this.currIndex=0;this.moreAddress="";this.photoGrid=new detail.photoGrid();this.createType=function(id){var bg=document.createElement('div'),text=document.createElement('div'),seperator=document.createElement('div');text.id="detailtypeText_"+id;text.className="detailtypeText";seperator.id="detailtypeSeperator_"+id;seperator.className="detailtypeSeperator";bg.id="detailtype_"+id;bg.className="detailtype";bg.appendChild(text);if(id!=3){bg.appendChild(seperator);}
bg.setText=function(value){text.innerHTML=value||"N/A";};return bg;};this.createBtn=function(label,id){var bg=document.createElement('div'),img=document.createElement('div'),cursor=document.createElement('div'),text=document.createElement('div');img.id="detailBtnImg_"+id;img.className="detailBtnImg";cursor.id="detailBtnCursor_"+id;cursor.className="detailBtnCursor";text.id="detailBtnTxt_"+id;text.className="detailBtnTxt";text.innerHTML=label||"Button";bg.id="detailBtn_"+id;bg.className="detailBtn";img.appendChild(text);img.appendChild(cursor);bg.appendChild(img);bg.enter_focus=function(){cursor.style.display="block";if(this.id=="detailBtn_2"){$("#detailBtnCursor_2").addClass('detailMapCursor');}};bg.leave_focus=function(){cursor.style.display="none";};return bg;};this.setHeading=function(name){var value=name||"";headingval.innerHTML=value;};this.show=function(data){heading.id="detailheading";heading.className="detailheading";headingval.id="detailheadingval";headingval.className="detailheadingval";imgbg.id="detailimgBg";imgbg.className="detailimgBg";loading.id="loadingTxt";loading.className="loadingTxt";loading.innerHTML="Loading...";img.id="detailimg";img.className="detailimg fadingAnim";address.id="detailaddress";address.className="detailaddress";typebg.id="detailtypebg";typebg.className="detailtypebg";cuisine=this.createType(0);restaurant=this.createType(1);dish=this.createType(2);theme=this.createType(3);typesArr=[cuisine,restaurant,dish,theme];phonetxt.id="detailphonetxt";phonetxt.className="detailphonetxt";phonetxt.innerHTML="Phone: ";phoneval.id="detailphoneval";phoneval.className="detailphoneval";pricetxt.id="detailpricetxt";pricetxt.className="detailpricetxt";pricetxt.innerHTML="Spending: ";priceval.id="detailpriceval";priceval.className="detailpriceval";priceBg.id="detailprice";priceBg.className="detailprice";costBg.id="costDetail";costBg.className="costDetail";dishtxt.id="detaildishtxt";dishtxt.className="detaildishtxt";dishtxt.innerHTML="Signature Dish(es): ";sigdish.id="detaildish";sigdish.className="detaildish";smileybg.id="smiley";smileybg.className="smiley";smileysmile.id="smiley_1";smileysmile.className="smileysmile";smileysmiletxt.id="smiley1";smileysmiletxt.className="smileysmiletxt";smileyok.id="smiley_2";smileyok.className="smileyok";smileyoktxt.id="smiley2";smileyoktxt.className="smileyoktxt";smileycry.id="smiley_3";smileycry.className="smileycry";smileycrytxt.id="smiley3";smileycrytxt.className="smileycrytxt";heading.appendChild(headingval);priceBg.appendChild(phonetxt);priceBg.appendChild(phoneval);costBg.appendChild(pricetxt);costBg.appendChild(priceval);sigdish.appendChild(dishtxt);mapBtn=this.createBtn("Location Map",1);moreBtn=this.createBtn("More Details",2);this.components[0]=mapBtn;this.components[1]=moreBtn;smileybg.appendChild(smileysmiletxt);smileybg.appendChild(smileysmile);smileybg.appendChild(smileyoktxt);smileybg.appendChild(smileyok);smileybg.appendChild(smileycrytxt);smileybg.appendChild(smileycry);bg.appendChild(heading);bg.appendChild(imgbg);imgbg.appendChild(loading);imgbg.appendChild(img);bg.appendChild(address);bg.appendChild(typebg);bg.appendChild(priceBg);bg.appendChild(costBg);bg.appendChild(sigdish);bg.appendChild(mapBtn);bg.appendChild(moreBtn);bg.id="detailBg";bg.className="detailBg";topsection.appendChild(bg);topsection.appendChild(smileybg);global.rigthNav=this;if(data.Root.Data[0].Pois&&data.Root.Data[0].Pois[0]&&data.Root.Data[0].Pois[0].Poi&&data.Root.Data[0].Pois[0].Poi[0]){this.setData(data);}else if(data.Root.Data[0].Errors){this.setDataError();}else{this.setDataError();}
if(detail.latitude==0&&detail.longitude==0){mapBtn.style.opacity="0.4";this.currIndex=1;}};this.setDataError=function(){$("#loadingTxt").css("display","none");$("#detailimg").attr("src","images/detail/default_image.png");$("#detailphoneval").text("N/A");$("#detaildishval").text("N/A");$("#detailaddress").text("N/A");$("#smiley").css("visibility","hidden");};detail.error=function(){global.showError("detail","clearBottom");global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();global.rigthNav=null;}
this.checkSize=function(){if(!parseInt(smileysmiletxt.innerHTML)&&!parseInt(smileyoktxt.innerHTML)&&!parseInt(smileycrytxt.innerHTML)){$("#smiley").remove();return false;}
switch(Math.max(parseInt(smileysmiletxt.innerHTML),parseInt(smileyoktxt.innerHTML),parseInt(smileycrytxt.innerHTML))){case parseInt($("#smiley1").text()):$("#smiley_1").css("height","100px");$("#smiley_1").css("margin-top","0px");if(parseInt($("#smiley1").text())==parseInt($("#smiley2").text())){$("#smiley_2").css("height","100px");$("#smiley_2").css("margin-top","0px");}
if(parseInt($("#smiley1").text())==parseInt($("#smiley3").text())){$("#smiley_3").css("height","100px");$("#smiley_3").css("margin-top","0px");}
break;case parseInt($("#smiley2").text()):$("#smiley_2").css("height","100px");$("#smiley_2").css("margin-top","0px");if(parseInt($("#smiley2").text())==parseInt($("#smiley1").text())){$("#smiley_1").css("height","100px");$("#smiley_1").css("margin-top","0px");}
if(parseInt($("#smiley2").text())==parseInt($("#smiley3").text())){$("#smiley_3").css("height","100px");$("#smiley_3").css("margin-top","0px");}
break;case parseInt($("#smiley3").text()):$("#smiley_3").css("height","100px");$("#smiley_3").css("margin-top","0px");if(parseInt($("#smiley3").text())==parseInt($("#smiley2").text())){$("#smiley_2").css("height","100px");$("#smiley_2").css("margin-top","0px");}
if(parseInt($("#smiley3").text())==parseInt($("#smiley1").text())){$("#smiley_1").css("height","100px");$("#smiley_1").css("margin-top","0px");}
break;}}
this.setData=function(param){try{var data=param||{};var signatureDish="";this.setHeading(data.Root.Data[0].Pois[0].Poi[0].NameLang1);if(data.Root.Data[0].Pois[0].Poi[0].DoorPhotos&&data.Root.Data[0].Pois[0].Poi[0].DoorPhotos[0].DoorPhoto&&data.Root.Data[0].Pois[0].Poi[0].DoorPhotos[0].DoorPhoto[0].UrlLarge){img.src=data.Root.Data[0].Pois[0].Poi[0].DoorPhotos[0].DoorPhoto&&data.Root.Data[0].Pois[0].Poi[0].DoorPhotos[0].DoorPhoto[0].UrlLarge;}else{img.src=detail.errorImgSrc;}
function imgLoad(){$("#loadingTxt").css("display","none");$("#"+img.id).css("display","block");}
function imgError(){$("#loadingTxt").css("display","none");$("#"+img.id).attr("src","images/detail/default_image.png");}
img.onload=imgLoad;img.onerror=imgError;var add=(data.Root.Data[0].Pois[0].Poi[0].AddressLang1?data.Root.Data[0].Pois[0].Poi[0].AddressLang1:"");var dis=(data.Root.Data[0].Pois[0].Poi[0].Districts[0].District[0].NameLang1?data.Root.Data[0].Pois[0].Poi[0].Districts[0].District[0].NameLang1:"");var loc=((add!=""?(dis!=""?(add+", "+dis):(add)):"N/A"));address.innerHTML="<div id='detaillocation'>Address: </div>"+loc.toString();this.moreAddress=loc.toString();var divh=$('#detailaddress').height();var txt="";while(divh>80){$('#detailaddress').html(function(index,html){txt=html.replace(/\W*\s(\S)*$/,'...');divh=$('#detailaddress').height();return txt;});}
var cat=(data.Root.Data[0].Pois[0].Poi[0].Categories?(data.Root.Data[0].Pois[0].Poi[0].Categories[0]?(data.Root.Data[0].Pois[0].Poi[0].Categories[0].Category?data.Root.Data[0].Pois[0].Poi[0].Categories[0].Category:""):""):"");var type=this.fliter(cat);var value="";for(var i in type){typesArr[i].setText(type[i]+"|");value+=type[i];if(i!=type.length-1){value+="<span> | </span>";}}
var moreCatValue="";for(var i in cat){moreCatValue+=cat[i].NameLang1;if(i!=cat.length-1){moreCatValue+="<span> | </span>";}}
txt=parseInt(cat.length)>1?'Categories: ':'Category: ';typebg.innerHTML="<div id='category'>"+txt+"</div>"+(value!=""?value:"N/A");detail.category=(moreCatValue!=""?moreCatValue:"N/A");phoneval.innerHTML=data.Root.Data[0].Pois[0].Poi[0].Phone||"N/A";priceval.innerHTML=data.Root.Data[0].Pois[0].Poi[0].PriceDescription||"N/A";try{for(var v in data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag){if(data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag[v]){signatureDish+=(data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag[v].NameLang1!=""?data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag[v].NameLang1+", ":"");}}
if(signatureDish==""){sigdish.innerHTML+="N/A";}else{signatureDish=signatureDish.slice(0,signatureDish.length-2);sigdish.innerHTML+=signatureDish;}}catch(e){sigdish.innerHTML+="N/A";}
smileysmiletxt.innerHTML=(data.Root.Data[0].Pois[0].Poi[0].ScoreSmile||data.Root.Data[0].Pois[0].Poi[0].ScoreSmile!="")?data.Root.Data[0].Pois[0].Poi[0].ScoreSmile:0;if(smileysmiletxt.innerHTML==""){smileysmiletxt.innerHTML=0;}
smileyoktxt.innerHTML=(data.Root.Data[0].Pois[0].Poi[0].ScoreOK||data.Root.Data[0].Pois[0].Poi[0].ScoreOK!="")?data.Root.Data[0].Pois[0].Poi[0].ScoreOK:0;if(smileyoktxt.innerHTML==""){smileyoktxt.innerHTML=0;}
smileycrytxt.innerHTML=(data.Root.Data[0].Pois[0].Poi[0].ScoreCry||data.Root.Data[0].Pois[0].Poi[0].ScoreCry!="")?data.Root.Data[0].Pois[0].Poi[0].ScoreCry:0;if(smileycrytxt.innerHTML==""){smileycrytxt.innerHTML=0;}
this.checkSize();}catch(e){}};this.fliter=function(list){var list=list||[]
var id=[1,2,3,4];var cuisineObj=[];for(var i=0;i<id.length;i++){for(var a in list){if(list[a].TypeId==id[i]){cuisineObj.push(list[a].NameLang1);break;}}}
return cuisineObj;};this.filterDish=function(list){var list=list||[];var cuisineObj=list.filter(function(list){return list.NameLang1;});}
this.enter_focus=function(){global.focusedDom=this;this.components[this.currIndex].enter_focus();};this.leave_focus=function(){this.components[this.currIndex].leave_focus();};this.reset=function(){this.currIndex=0;detail.returnObj=2;}
this.KeyboardEvent=function(e,eventType){try{var target=_target(e),keyCode=target.keyCode,key=global.keyCodeDic[keyCode];switch(eventType){case"keydown":switch(key){case"arrowup":return true;break;case"arrowdown":if($("#gridSection").length>0){this.leave_focus();this.photoGrid.enter_focus();}else if($("#HotKey_4").length>0){this.leave_focus();detailHotKey.enter_focus();}
return true;case"ok":if(this.currIndex==0){global.clearContents();$("#hotKeyCont").html("");detail.returnObj=0;detail.mapContainer.create();}else{this.leave_focus();morePopUp.createMorePopUp();}
break;case"arrowleft":this.leave_focus();if(this.currIndex==0){global.rigthNav=this;global.mainMenu.enter_focus();}else{if($("#detailBtn_1").css("opacity")>=1){this.currIndex=0;this.enter_focus();}else{global.rigthNav=this;global.mainMenu.enter_focus();}}
return true;break;case"arrowright":if(this.currIndex==0){this.leave_focus();this.currIndex=1;this.enter_focus();}
return true;break;}
break;}}catch(e){}};};detail.photoGrid=function(){var wrapper=document.getElementById('detailBottomsection'),total=0,totalPages=0,currentPage=1,itemsReqd=0,maxItems=10;this.components=[];this.currentItem=0;this.prevItem=0;parent=document.createElement('div');parent.id="gridSection";parent.className="gridSection";wrapper.appendChild(parent);this.error=function(param){$("#detailBottomsection").html(param);$("#grid_pagination").html("");global.arrow.showArrow("none");detail.main.enter_focus();}
this.gird=function(param){var bg=document.createElement('div'),loading=document.createElement('p'),img=document.createElement('img'),cursor=document.createElement('div');loading.id="thumbnailLoading_"+param.id;loading.className="detailThumbnailLoading";loading.innerHTML="Loading...";img.id="detailGridImg_"+param.id;img.className="detailGridImg fadingAnim";cursor.id="detailGridImgCursor_"+param.id;cursor.className="detailGridImgCursor";img.src=param.src;function imgLoad(){$("#thumbnailLoading_"+param.id).css("display","none");$("#"+img.id).css("display","block");}
function imgError(){$("#loadingText"+param.id).css("display","none");$("#"+img.id).attr("src","images/detail/default_image.png");}
img.onload=imgLoad;img.onerror=imgError;bg.appendChild(cursor);cursor.appendChild(loading);cursor.appendChild(img);bg.id="detailGrid_"+param.id;bg.className="detailGrid";bg.setCursor=function(){$("#"+cursor.id).addClass('thumbnailCursor');$("#"+bg.id).addClass('shadow');};bg.removeCursor=function(){$("#"+cursor.id).removeClass('thumbnailCursor');$("#"+bg.id).removeClass('shadow');};return bg;};this.create=function(data){try{data=data||{};parent.innerHTML="";this.components=[];total=data.Root.Data[0].Photos[0].total||0;if(total==0){return;}
totalPages=parseInt(total/maxItems)+((total%maxItems)==0?0:1);itemsReqd=(totalPages==detail.currentPage)?(total%maxItems):maxItems;if(0==itemsReqd){itemsReqd=maxItems;}
for(var item in data.Root.Data[0].Photos[0].Photo){parent.appendChild(this.gird({'id':item,'src':data.Root.Data[0].Photos[0].Photo[item].UrlMedium||detail.errorImgSrc,}));};itemsReqd=data.Root.Data[0].Photos[0].Photo.length;while(itemsReqd--){id="detailGrid_"+itemsReqd;this.components[itemsReqd]=document.getElementById(id);};this.setArrow();}catch(e){}};this.enter_focus=function(){global.focusedDom=this;detail.returnObj=2;this.components[this.currentItem].setCursor();};this.leave_focus=function(){this.components[this.currentItem].removeCursor();};this.free=function(){parent.innerHTML="";this.components=[];};this.reset=function(){this.currentItem=0;this.prevItem=0;currentPage=1;detail.main.reset();}
this.setArrow=function(){if(totalPages==1){return;}
if(detail.currentPage==1){global.arrow.showArrow("right");}else if(detail.currentPage>1&&detail.currentPage<totalPages){global.arrow.showArrow("both");}else if(detail.currentPage==totalPages){global.arrow.showArrow("left");}
$("#grid_pagination").html((detail.currentPage+" of "+totalPages).toString());}
this.KeyboardEvent=function(e,eventType){try{var target=_target(e),keyCode=target.keyCode,key=global.keyCodeDic[keyCode];$('#downArrow').removeClass("arrowAnim");$('#upArrow').removeClass("arrowAnim");switch(eventType){case"keydown":switch(key){case"arrowup":if(this.components[this.currentItem-5]){this.prevItem=this.currentItem;this.components[this.prevItem].removeCursor();this.currentItem=this.currentItem-5;this.components[this.currentItem].setCursor();}else if($("#detailBtn_1").css("opacity")>=1){this.leave_focus();detail.main.enter_focus();}
return true;break;case"arrowdown":if(this.components[this.currentItem+5]){this.prevItem=this.currentItem;this.components[this.prevItem].removeCursor();this.currentItem=this.currentItem+5;this.components[this.currentItem].setCursor();}else{if($("#gridSection").children().length>=6&&this.currentItem<=4){this.prevItem=this.currentItem;this.components[this.prevItem].removeCursor();this.currentItem=$("#gridSection").children().length-1;this.components[this.currentItem].setCursor();}else if($("#HotKey_4").length>0){this.prevItem=this.currentItem;this.components[this.prevItem].removeCursor();detailHotKey.enter_focus();}}
return true;case"ok":detail.returnObj=2;detail.photoIndex=detail.main.photoGrid.currentItem;global.clearContents();$("#hotKeyCont").html("");if(this.currentItem>4){detail.loadPhotos(global.getServer(search.getSelections({"category":"region","type":"country"}))+"/api/api.htm?method=or.poi.getphoto&poi_id="+listing.selectedItem+"&page="+parseInt(detail.currentPage*2)+"&per_page=5&api_token=apitoken&api_sig=apisignature&app_type=orpanasonic&response_type=json&api_ver=&keyword=&lang=&Misc=&reloadcache=0&ret_info=&search_type=");}else{detail.loadPhotos(global.getServer(search.getSelections({"category":"region","type":"country"}))+"/api/api.htm?method=or.poi.getphoto&poi_id="+listing.selectedItem+"&page="+parseInt(detail.currentPage*2-1)+"&per_page=5&api_token=apitoken&api_sig=apisignature&app_type=orpanasonic&response_type=json&api_ver=&keyword=&lang=&Misc=&reloadcache=0&ret_info=&search_type=");}
break;case"arrowright":if(this.components[this.currentItem+1]&&(this.currentItem+1)%5!=0){this.prevItem=this.currentItem;this.components[this.prevItem].removeCursor();this.components[++this.currentItem].setCursor();return true;}else{if(detail.currentPage!=totalPages){detail.currentPage++;this.currentItem++;this.prevItem=this.currentItem;this.free();$('#upArrow').addClass("arrowAnim");detail.getPhoto(detail.currentPage,"right",677);return true;}}
return true;break;case"arrowleft":if(this.components[this.currentItem-1]&&(this.currentItem)%5!=0){this.prevItem=this.currentItem;this.components[this.prevItem].removeCursor();this.components[--this.currentItem].setCursor();}else{if(detail.currentPage!=1){detail.currentPage--;this.prevItem=this.currentItem;this.free();$('#downArrow').addClass("arrowAnim");detail.getPhoto(detail.currentPage,"left",677);}else{this.components[this.currentItem].removeCursor();global.rigthNav=this;detail.main.reset();global.mainMenu.enter_focus();}}
return true;break;}
break;}}catch(e){}};}
detail.getDetail=function(){var URL=global.getServer(search.getSelections({"category":"region","type":"country"}))+"/api/api.htm?method=or.poi.getdetail&poi_id="+listing.selectedItem+"&api_token=apitoken&api_sig=apisignature&app_type=orpanasonic&response_type=json&api_ver=&keyword=&lang=&Misc=&page=1&per_page=12&reloadcache=0&ret_info=&search_type=";try{global.loading.On();$.ajax({type:"GET",url:URL,dataType:"json",headers:{'or-token':global.OR_Token,},timeout:30000,success:function(data){try{global.splash.Off();global.loading.Off();if(data.Root.Data[0].Pois&&data.Root.Data[0].Pois[0]&&data.Root.Data[0].Pois[0].Poi&&data.Root.Data[0].Pois[0].Poi[0]){if(data.Root.Data[0].Pois){global.mainMenu.makeSelected(0);detail.mapContainer.storeData(data);detail.main.show(data);detail.getPhoto(detail.currentPage);}else if(data.Root.Data[0].Errors){detail.error();}}else{detail.error();}}catch(e){global.splash.Off();global.loading.Off();detail.error();}},error:function(jqXHR,textStatus,errorThrown){global.rigthNav=null;global.splash.Off();global.loading.Off();global.showError("network","clearBottom");global.mainMenu.enter_focus();}});}catch(e){global.loading.Off();global.splash.Off();detail.error();}};detail.getPhoto=function(page,to,loadingPos){try{global.loading.On(loadingPos);var page=page||1;photoUrl=global.getServer(search.getSelections({"category":"region","type":"country"}))+"/api/api.htm?method=or.poi.getphoto&poi_id="+listing.selectedItem+"&page="+page+"&per_page=10&api_token=apitoken&api_sig=apisignature&app_type=orpanasonic&response_type=json&api_ver=&keyword=&lang=&Misc=&reloadcache=0&ret_info=&search_type="
$.ajax({type:"GET",url:photoUrl,dataType:"json",headers:{'or-token':global.OR_Token,},timeout:30000,success:function(data){try{if(data&&data.Root&&data.Root.Data){global.loading.Off();if(data.Root.Data[0].Photos){try{if(data.Root.Data[0].Photos[0].total>0){detail.main.photoGrid.create(data);if(to){if(to=="left"){if(detail.main.photoGrid.currentItem==0||detail.main.photoGrid.currentItem==5){if(detail.main.photoGrid.components[detail.main.photoGrid.currentItem+4]){detail.main.photoGrid.currentItem=detail.main.photoGrid.currentItem+4;}else{detail.main.photoGrid.currentItem=0;}}}else if(to="right"){if(detail.main.photoGrid.currentItem==5||detail.main.photoGrid.currentItem==10){if(detail.main.photoGrid.components[detail.main.photoGrid.currentItem-5])
detail.main.photoGrid.currentItem=detail.main.photoGrid.currentItem-5;else
detail.main.photoGrid.currentItem=0;}}
if(detail.main.photoGrid.currentItem>detail.main.photoGrid.components.length-1){detail.main.photoGrid.currentItem=0;}
detail.main.photoGrid.components[detail.main.photoGrid.currentItem].setCursor();}else{detail.setScreenCursor();}}else{detail.main.photoGrid.error("No photo(s) available.");}}catch(e){detail.main.photoGrid.error("No photo(s) available.");}}else{detail.main.photoGrid.error("No photo(s) available.");}}else{global.loading.Off();detail.main.photoGrid.error("No photo(s) available.");}}catch(e){global.loading.Off();detail.main.photoGrid.error("No photo(s) available.");}},error:function(jqXHR,textStatus,errorThrown){global.loading.Off();detail.main.photoGrid.error("No photo(s) available.");}});}catch(e){global.loading.Off();detail.main.photoGrid.error("No photo(s) available.");}};}catch(e){}
function initialize(){try{detail.location=new google.maps.LatLng(detail.latitude,detail.longitude);var mapDiv=document.getElementById('map');var myOptions={zoom:parseInt(detail.zoomVal),maxZoom:20,minZoom:1,panControl:false,disableDefaultUI:true,center:detail.location,mapTypeId:google.maps.MapTypeId.ROADMAP};detail.map=new google.maps.Map(mapDiv,myOptions);global.loading.Off();google.maps.event.addListener(detail.map,'tilesloaded',function(){global.loading.Off();});var marker=new google.maps.Marker({position:detail.location,map:detail.map,});var directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:true});}catch(e){global.loading.Off();detail.mapContainer.free();global.showError("network","clearBottom");global.rigthNav=null;global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();}}
function b64_to_utf8(str){return decodeURIComponent(escape(window.atob(str)));}
detail.mapContainer=(function(){var obj={};obj.createTop=function(){var top="<div id='mapTop'>"+detail.restaurantName+"</div>";$("#innerSection").append(top);top="<div id='mask'></div>";if(!$("#bottomSection").hasClass("bottomSectionBg")){$("#bottomSection").addClass("bottomSectionBg");}
$("#bottomSection").append(top);}
obj.storeData=function(data){detail.zoomVal=data.Root.Data[0].Pois[0].Poi[0].MapZoom||15;if(data.Root.Data[0].Pois[0].Poi[0].MapZoom<=0){detail.zoomVal=15;}
detail.latitude=data.Root.Data[0].Pois[0].Poi[0].MapLatitude;detail.longitude=data.Root.Data[0].Pois[0].Poi[0].MapLongitude;var add=(data.Root.Data[0].Pois[0].Poi[0].AddressLang1?data.Root.Data[0].Pois[0].Poi[0].AddressLang1:"");var dis=(data.Root.Data[0].Pois[0].Poi[0].Districts[0].District[0].NameLang1?data.Root.Data[0].Pois[0].Poi[0].Districts[0].District[0].NameLang1:"");var loc=((add!=""?(dis!=""?(add+", "+dis):(add)):"N/A"));detail.address=loc.toString();try{detail.signatureDish="";for(var v in data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag){if(data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag[v]){detail.signatureDish+=(data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag[v].NameLang1!=""?data.Root.Data[0].Pois[0].Poi[0].Tags[0].Tag[v].NameLang1+", ":"");}}
if(detail.signatureDish==""){detail.signatureDish="N/A";}else{detail.signatureDish=detail.signatureDish.slice(0,detail.signatureDish.length-2);}}catch(e){detail.signatureDish="N/A";}
detail.tel_num=data.Root.Data[0].Pois[0].Poi[0].Phone||"N/A";detail.restaurantName=data.Root.Data[0].Pois[0].Poi[0].NameLang1||"Retaurant name not available";}
obj.create=function(){global.screen=5;$("#arrows").css("display","none");obj.createTop();var map="<div id='mapCont'><div id='address'>"+detail.address+"</div><div id='sig_tel'><div id='telLabel' class='sigLabel' >Phone: </div><div class='sigLabel'>"+detail.tel_num+"</div></div><div id='mapImg'><div id='map'></div></div></div>";$("#innerSection").append(map);map="<div id='mask'></div><div id='mapControls'><div  class='mapCursor' id='zoomInCur'><div  class='controls' id='cur_1'>Zoom In</div></div><div  class='mapCursor' id='zoomOutCur'><div  class='controls' id='cur_2'>Zoom Out</div></div><div class='mapHotKey' id='upCur'><div class='controls' id='cur_3'></div></div><div  class='mapHotKey' id='downCur'><div  class='controls' id='cur_4'></div></div><div  class='mapHotKey' id='leftCur'><div  class='controls' id='cur_5'></div></div><div  class='mapHotKey' id='rightCur'><div  class='controls' id='cur_6'></div></div><div  id='resetMapOuter'><div id='cur_7'>Reset Map</div></div><div  class='mapBack' id='back'><div  class='controls' id='cur_8'>Back</div></div></div>";$("#bottomSection").html(map);$("#cur_7").css("color","#c4aa97");global.loading.On(530);obj.loadScript();obj.enter_focus();if(detail.tel_num=="N/A"){$("#sig_tel").css("display","none");}}
obj.loadScript=function(){try{if(typeof google==='object'&&typeof google.maps==='object'){initialize();}else{var source="http://maps.googleapis.com/maps/api/js?key="+b64_to_utf8(encodeVal).toString()+"&sensor=false&callback=initialize";var script=document.createElement("script");script.type="text/javascript";script.src=source;script.onerror=function(){global.loading.Off();detail.mapContainer.free();global.showError("network","clearBottom");global.rigthNav=null;global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();};document.body.appendChild(script);}}catch(e){global.loading.Off();detail.mapContainer.free();global.showError("network","clearBottom");global.rigthNav=null;global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();}}
obj.enter_focus=function(){global.focusedDom=this;if(detail.curMapObj<=2||detail.curMapObj>=7){$("#cur_"+detail.curMapObj).css("background","url('images/button_curser_map.png') no-repeat");}else{$("#cur_"+detail.curMapObj).addClass("mapHotKeyCurser");}}
obj.leave_focus=function(){if(detail.curMapObj<=2||detail.curMapObj>=7){$("#cur_"+detail.curMapObj).css("background","");}else{$("#cur_"+detail.curMapObj).removeClass("mapHotKeyCurser");}}
obj.free=function(){global.clearContents();detail.curMapObj=1;$("#mask").remove();$("#mapControls").remove();}
obj.KeyboardEvent=function(e,eventType){var target=_target(e),keyCode=target.keyCode,key=global.keyCodeDic[keyCode];switch(eventType){case"keydown":switch(key){case"arrowleft":obj.leave_focus();detail.curMapObj--;if($("#cur_"+detail.curMapObj).length>0){obj.enter_focus();}else{detail.curMapObj++;global.rigthNav=this;global.mainMenu.enter_focus();}
break;case"arrowright":detail.curMapObj++;if($("#cur_"+detail.curMapObj).length>0){detail.curMapObj--;obj.leave_focus();detail.curMapObj++;obj.enter_focus();}else{detail.curMapObj--;}
break;case"ok":switch(detail.curMapObj){case 1:if($("#cur_1").css("color")!="rgb(196, 170, 151)"){if(detail.map.getZoom()+1<=20){detail.map.setZoom(detail.map.getZoom()+1);$("#cur_2").css("color","white");$("#cur_7").css("color","white");}
if(detail.map.getZoom()==20){$("#cur_1").css("color","#c4aa97");}}
break;case 2:if($("#cur_2").css("color")!="rgb(196, 170, 151)"){if(detail.map.getZoom()-1>1){detail.map.setZoom(detail.map.getZoom()-1);$("#cur_1").css("color","white");$("#cur_7").css("color","white");}
if(detail.map.getZoom()-1==1){$("#cur_2").css("color","#c4aa97");}}
break;case 3:detail.map.panBy(0,-100);$("#cur_7").css("color","white");break;case 4:detail.map.panBy(0,100);$("#cur_7").css("color","white");break;case 5:detail.map.panBy(-100,0);$("#cur_7").css("color","white");break;case 6:detail.map.panBy(100,0);$("#cur_7").css("color","white");break;case 7:if($("#cur_7").css("color")!="rgb(196, 170, 151)"){detail.map.setCenter(detail.location);detail.map.setZoom(parseInt(detail.zoomVal));if(detail.map.getZoom()<=20){$("#cur_2").css("color","white");}else{$("#cur_2").css("color","#c4aa97");}
if(detail.map.getZoom()>1){$("#cur_1").css("color","white");}else{$("#cur_2").css("color","white");}
$("#cur_7").css("color","#c4aa97");}
return true;break;case 8:global.clearContents();detail.mapContainer.free();$("#arrows").css("display","block");detail.createDetail("map");break;}
break;}
return false;}
return false;};return obj;})();detail.loadPhotos=function(url,from){try{global.loading.On(767);global.screen=4;$.ajax({type:"GET",url:url,dataType:"json",headers:{'or-token':global.OR_Token,},timeout:30000,success:function(data){try{global.loading.Off();if(data&&data.Root&&data.Root.Data){if(data.Root.Data[0].Errors){global.showError("photos","clearBottom");global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();}else{detail.gridContainer.create(data);}}else{detail.gridContainer.error();global.showError("photos","clearBottom");global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();}}catch(e){detail.gridContainer.error();global.showError("photos","clearBottom");global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();}},error:function(jqXHR,textStatus,errorThrown){detail.gridContainer.error();global.loading.Off();global.showError("network","clearBottom");global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();},});}catch(e){global.loading.Off();global.showError("photos","clearBottom");global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();}}
detail.gridContainer=(function(){var obj={};var cur=0;var DataObj="";var page=1,initCall=0;obj.createFrame=function(){global.clearContents();if(detail.main.photoGrid.currentItem>4){page=detail.currentPage*2;}else{page=detail.currentPage*2-1;}
cur=detail.main.photoGrid.currentItem%5;var outer="<div id='title'>"+detail.restaurantName+"</div><div id='topCont'><div id='searchList'><div id='caption'></div></div><div id='enlargedImageCont'><div id='imgCaptionCont'><p id='EnlargeLoading'>Loading...</p></div></div></div></div><div id='foodMenuCont'><div id='inner'></div></div>";$("#innerSection").append(outer);var bg=document.createElement('img');bg.id="enlargedImg";bg.className="fadingAnim";function imgLoad(){$("#enlargedImg").css("display","block");$("#EnlargeLoading").css("display","none");$("#enlargedImg").css("opacity")
$("#enlargedImg").css("opacity","1");}
function imgError(){document.getElementById('EnlargeLoading').style.display="none";bg.src="images/detail/default_image.png";bg.style.display="block";}
bg.onload=imgLoad;bg.onerror=imgError;document.getElementById('imgCaptionCont').appendChild(bg);}
obj.arrowCheck=function(){if(parseInt((5*(DataObj.Root.Data[0].Photos[0].page-1)))+parseInt(DataObj.Root.Data[0].Photos[0].count)<DataObj.Root.Data[0].Photos[0].total){global.arrow.showArrow("right");}else{global.arrow.showArrow();}
if(DataObj.Root.Data[0].Photos[0].page!=1){$('#downArrow').css('background-position',"0px -50px");}else{$('#downArrow').css('background-position',"0px 0px");}}
obj.createThumbnail=function(){outer="";var totalRows=DataObj.Root.Data[0].Photos[0].count/5;if(DataObj.Root.Data[0].Photos[0].count%5!=0){totalRows++;}
for(var loopVar=0;loopVar<DataObj.Root.Data[0].Photos[0].count;loopVar++){outer="<div class='foodGrid' id='foodMenuInner"+loopVar+"'><div id='foodMenuCursor"+loopVar+"'><p id='thumbnailLoading_"+loopVar+"' class='thumnailLoading'>Loading...</p><img id='image_"+loopVar+"' class='foodImg' /></div></div>";$("#inner").append(outer);$("#image_"+loopVar).attr("src",DataObj.Root.Data[0].Photos[0].Photo[loopVar].UrlMedium);$("#image_"+loopVar).load(function(){$("#thumbnailLoading_"+this.id.split("image_")[1]).css("display","none");$("#"+this.id).css("display","block");});$("#image_"+loopVar).error(function(){$("#loadingText"+this.id.split("image_")[1]).css("display","none");$("#"+this.id).attr("src","images/detail/default_image.png");});}
for(loopVar=1;loopVar<DataObj.Root.Data[0].Photos[0].count;loopVar++){$("#foodMenuInner"+loopVar).addClass("left");}
if(parseInt(DataObj.Root.Data[0].Photos[0].total)<5){var totallen=parseInt((269*DataObj.Root.Data[0].Photos[0].count)+(19*(DataObj.Root.Data[0].Photos[0].count-1)));totallen=parseInt((1420/2)-(totallen/2));$("#foodMenuCont").css("margin-left",totallen);}
if(initCall!=0){obj.arrowCheck();obj.enter_focus(cur);}}
obj.create=function(data){if(data.Root.Data[0].Photos[0].total<=0){global.clearContents();global.showError("photos","clearBottom");global.mainMenu.makeSelected(0);global.mainMenu.enter_focus();}else{if(initCall!=1){obj.createFrame();if(global.gadget==1){detailHotKey.create({"type":"Search"});}else if(global.gadget==2){detailHotKey.index=0;detailHotKey.create({"type":"Gadget"});}else{detailHotKey.create({"type":"Refine Search"});}}
DataObj=data;obj.createThumbnail();var loopVar=parseInt(DataObj.Root.Data[0].Photos[0].total/5);if(parseInt(DataObj.Root.Data[0].Photos[0].total)%5!=0){loopVar++;}
if(initCall!=1){initCall=1;outer="<div id='page'>"+DataObj.Root.Data[0].Photos[0].page+" of "+loopVar+"</div>";$("#bottomSection").append(outer);obj.arrowCheck();obj.enter_focus(cur);}else{$("#page").text(DataObj.Root.Data[0].Photos[0].page+" of "+loopVar);}
if(loopVar<=1){$("#page").css("visibility","hidden");}}};obj.enter_focus=function(index){detail.photoIndex=index;$("#foodMenuCursor"+index).addClass("cursor");$("#foodMenuInner"+index).addClass('shadow');global.focusedDom=this;cur=index;if(global.rigthNav!=""){global.rigthNav="";if(document.getElementById('enlargedImg').src!=DataObj.Root.Data[0].Photos[0].Photo[index].UrlLarge){document.getElementById('enlargedImg').style.display="none";$("#enlargedImg").css("opacity","0");document.getElementById('EnlargeLoading').style.display="block";document.getElementById('enlargedImg').src=DataObj.Root.Data[0].Photos[0].Photo[index].UrlLarge;}}else{document.getElementById('enlargedImg').style.display="none";$("#enlargedImg").css("opacity","0");document.getElementById('EnlargeLoading').style.display="block";document.getElementById('enlargedImg').src=DataObj.Root.Data[0].Photos[0].Photo[index].UrlLarge;}
$("#caption").text(DataObj.Root.Data[0].Photos[0].Photo[index].Caption);};obj.leave_focus=function(index){$("#foodMenuCursor"+index).removeClass("cursor");$("#foodMenuInner"+index).removeClass('shadow');};obj.free=function(){$("#inner").html("");$("#EnlargeLoading").css("display","block");$("#enlargedImg").css("display","none");$("#caption").text("");};obj.error=function(){global.clearContents();global.rigthNav="";}
obj.reset=function(param){initCall=0;$("#page").remove();$("#arrows").css("display","block");param=param||"";if(param!=""){detail.currentPage=1;detail.photoIndex=0;page=0;}else{if(page>1){detail.currentPage=((page%2)>0?(parseInt(page/2)+1):parseInt(page/2));detail.photoIndex=((page%2)>0?(cur):(cur+5));}else{detail.currentPage=1;detail.photoIndex=((page%2)>=0?(cur):(cur+5));}}}
obj.KeyboardEvent=function(e,eventType){try{var target=_target(e),keyCode=target.keyCode,key=global.keyCodeDic[keyCode];$('#downArrow').removeClass("arrowAnim");$('#upArrow').removeClass("arrowAnim");switch(eventType){case"keydown":switch(key){case"arrowdown":global.rigthNav=this;obj.leave_focus(cur);detailHotKey.enter_focus();break;case"arrowright":try{cur++;if($("#foodMenuInner"+cur).length){obj.leave_focus(cur-1);obj.enter_focus(cur);}else{if(parseInt((5*(DataObj.Root.Data[0].Photos[0].page-1)))+parseInt(DataObj.Root.Data[0].Photos[0].count)<DataObj.Root.Data[0].Photos[0].total){page++;cur=0;obj.free();$('#upArrow').addClass("arrowAnim");detail.loadPhotos(global.getServer(search.getSelections({"category":"region","type":"country"}))+"/api/api.htm?method=or.poi.getphoto&poi_id="+listing.selectedItem+"&page="+page+"&per_page=5&api_token=apitoken&api_sig=apisignature&app_type=orpanasonic&response_type=json&api_ver=&keyword=&lang=&Misc=&reloadcache=0&ret_info=&search_type=");}else{cur--;return false;}}}catch(e){}
return true;break;case"arrowleft":cur--;if($("#foodMenuInner"+cur).length){obj.leave_focus(cur+1);obj.enter_focus(cur);}else{if(DataObj.Root.Data[0].Photos[0].page!=1){page--;cur=4;obj.free();$('#downArrow').addClass("arrowAnim");detail.loadPhotos(global.getServer(search.getSelections({"category":"region","type":"country"}))+"/api/api.htm?method=or.poi.getphoto&poi_id="+listing.selectedItem+"&page="+page+"&per_page=5&api_token=apitoken&api_sig=apisignature&app_type=orpanasonic&response_type=json&api_ver=&keyword=&lang=&Misc=&reloadcache=0&ret_info=&search_type=");}else{cur++;obj.leave_focus(cur);global.rigthNav=this;global.mainMenu.enter_focus();return false;}}
return true;break;}
return false;}
return false;}catch(e){}};return obj;})();